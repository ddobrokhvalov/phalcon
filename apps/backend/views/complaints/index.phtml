{% extends "base-template.phtml" %}
{% block title %}ФАС ОНЛАЙН - Жалобы{% endblock %}
{% block body %}
<div class="admin-main-wrap complaints-list">
    <h1>Список жалоб</h1>
    <div class="admin-lt-holder">
        <div class="admin-lt-content">
            <ul class="lt-content-top">
                <li></li>
                <li><span>Название жалобы</span></li>
                <li><span>№</span></li>
                <li><span>Дата</span></li>
                <li><span>Вопросы</span></li>
                <li><span>Статус</span></li>
                <li></li>
            </ul>
            {% for complaint in page.items %}
            <ul class="lt-content-main">
                <li></li>
                {% if complaint.purchases_name | length > 100 %}
                <li style="padding-top: 15px;">{{ truncate(complaint.purchases_name, 0, 100) }}</li>
                {% else %}
                <li style="padding-top: 25px;">{{ complaint.purchases_name }}</li>
                {% endif %}
                <li>{{ complaint.auction_id }}</li>
                <li>{{ date('Y.m.d', complaint.date|strtotime) }}</li>
                <li>{{ complaint.getCountQuestions(complaint.Question) }}</li>
                <li>{{ complaint.getComplaintStatus(complaint.status) }}</li>
                <li>{{ link_to("admin/complaints/preview/" ~ complaint.id, 'Просмотреть') }}</li>
            </ul>
            {% endfor %}
        </div>
    </div>
    {% if page.total_items > item_per_page %}
        <div class="admin-table-footer">
            {% if page.current * item_per_page < page.total_items %}
                {% set cnt = page.total_items - (page.current * item_per_page) %}
                <a href="#" onclick="$('#next_items').submit()">Еще <span>{{ cnt > item_per_page ? 20 : cnt}} жалоб</span></a><!--todo: -->
                {% else %}
                    <div></div>
            {% endif %}
            <a href="#">Показать все жалобы (<span>{{page.total_items}}</span>)</a><!--todo: -->
        </div>
        <form id="next_items" method="post">
            {{hidden_field('next-portions-items', 'value':20)}}
        </form>
    {% endif %}
    <div class="admin-pagination-box">
        {% if page.current>1 %}{{ link_to("admin/complaints/index?page=" ~ page.before, 'Предыдущие', 'id' : 'admin-pag-prev') }}{% endif %}
        <ul>
            {% for page_item in paginator_builder %}
            <li>
                {% if page_item['type'] == 'page' %}
                {{ link_to("admin/complaints/index?page=" ~ page_item['num'], page_item['num']) }}
                {% elseif page_item['type'] == 'delimer' %}
                <span>...</span>
                {% elseif page_item['type'] == 'current' %}
                <span class="active-pag-page">{{page_item['num']}}</span>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
        {% if page.total_pages > page.current %}{{ link_to("admin/complaints/index?page=" ~ page.next, 'Следующие', 'id' : 'admin-pag-next') }}{% endif %}
    </div>
</div>
{% endblock %}
